function e(e){const t=(()=>{const e=new Map;return{parse:function t(n){let r=e.get(n);return r||(r=function l(e){let t=e.split(/\{([^\}]*)\}/),n=[];return t.forEach(((e,t)=>{e&&n.push(t%2?function r(e){let t=[];e=e.replaceAll(/\(([^\)]*)\)/g,((e,n)=>(t.push(n.split(",").map((e=>e.trim()))),"()")));let n={};return e.replaceAll(/\s+/g,"").split(",").forEach((e=>{let r;e=e.replaceAll("()",(()=>(r=t.shift(),"")));let[l,i]=e.split(":",2);if(i){if("tpl"===l)n.tpl={path:i};else if("if"===l){let e="!"===i[0];e&&(i=i.substring(1)),n.if={not:e,func:null!=r,path:i,args:r}}else if("is"===l)n.is={name:i};else if("as"===l)n.as={name:i,args:r};else if("at"===l){let[e,t]=i.split("->",2);n.at={event:e,callback:t,args:r}}else if("do"===l)n.do={callback:i,args:r};else if("on"===l){n.on||(n.on=[]);let[e,t]=i.split("->",2);n.on.push({event:e,callback:t,args:r})}}else if(l){let e="$"===l[0];e&&(l=l.substring(1)),n.src={bind:e,path:l}}})),n}(e):{run:e})})),n}(n),e.set(n,r)),r}}})(),n=(()=>{const e=new WeakMap;function t(t,n){let r=e.get(t);if(r){let e=r.get(n);e&&e.forEach((e=>e.call(t)))}}return{notify:t,listen:function n(r,l,i){let s=e.get(r);s||(s=new Map,e.set(r,s));let o=s.get(l);o||(o=[],s.set(l,o),function a(e,n){let r=Object.getOwnPropertyDescriptor(e,n);if(!r||!r.configurable)throw{message:"Target is not observable",object:e,property:n};if(r.hasOwnProperty("value")){let l=e[n];Object.defineProperty(e,n,{configurable:!0,enumerable:r.enumerable,get:()=>l,set(r){l=r,t(e,n)}})}else if(r.set){let l=r.set;Object.defineProperty(e,n,{configurable:!0,enumerable:r.enumerable,get:r.get,set(r){l.call(e,r),t(e,n)}})}}(r,l)),o.push(i)},remove:function r(t,n,l){let i=e.get(t);if(!i)return;let s=i.get(n);if(!s)return;let o=s.indexOf(l);o>-1&&s.splice(o,1)}}})(),r=(()=>{const e=new WeakMap;function t(e,t){let n=[],r=[];for(let l=0,i=e.length;l<i;l++){let i=-1;do{i=t.indexOf(e[l],i+1)}while(n.includes(i));n.push(i),i!==l&&r.push({before:i,after:l})}return r}function r(t,r,l){let i=e.get(t);i&&i[r].forEach((e=>e.call(t,l))),"change"!==r&&n.notify(t,"count")}return{observe:function l(n){e.has(n)||(e.set(n,{insert:[],remove:[],change:[]}),Object.defineProperties(n,{push:{value:function l(...e){let t=n.length,l=Array.prototype.push.apply(n,e);return e.length&&r(n,"insert",{index:t,items:e}),l}},pop:{value:function i(){let e=n.length,t=Array.prototype.pop.apply(n);return e&&r(n,"remove",{index:e-1,items:[t]}),t}},unshift:{value:function s(...e){let t=Array.prototype.unshift.apply(n,e);return e.length&&r(n,"insert",{index:0,items:e}),t}},shift:{value:function o(){let e=n.length,t=Array.prototype.shift.apply(n);return e&&r(n,"remove",{index:0,items:[t]}),t}},reverse:{value:function a(){let e=n.slice(),l=Array.prototype.reverse.apply(n),i=t(n,e);return i.length&&r(n,"change",i),l}},sort:{value:function c(e){let l=n.slice(),i=Array.prototype.sort.apply(n,[e]),s=t(n,l);return s.length&&r(n,"change",s),i}},splice:{value:function f(e,t,...l){let i=n.length;e>i?e=i:e<0&&(e=Math.max(i+e,0));let s=Array.prototype.splice.apply(n,[e,t,...l]);return s.length&&r(n,"remove",{index:e,items:s}),l.length&&r(n,"insert",{index:e,items:l}),s}},count:{configurable:!0,enumerable:!1,get:()=>n.length}}))},listen:function i(t,n,r){let l=e.get(t);l&&l[n].push(r)},remove:function s(t,n,r){let l=e.get(t);if(l){let e=l[n].indexOf(r);e>-1&&l[n].splice(e,1)}}}})(),l={bypassTags:["TEMPLATE","PRE","CODE"]},i={},s={},o={},a={},c={},f={},u={},p={registry:{},tracking:new WeakMap,regcache:new Map,add(e,t){e in p.registry||(p.registry[e]=[]),p.registry[e].push(t)},listen(e){let t=e.split("."),r=t.pop(),l=y(t.join(".")),i=p.tracking.get(l);if(i){if(i.includes(r))return}else i=[],p.tracking.set(l,i);i.push(r),n.listen(l,r,(()=>{p.regcache.get(e).forEach((e=>{p.registry[e].forEach((t=>t(y(e)))),p.listen(e)})),p.registry[e].forEach((t=>t(y(e))))}))},cache(){let e=Object.keys(p.registry);for(let t of e){let n=e.filter((e=>e.startsWith(t+".")));n.sort(((e,t)=>t.split(".").length-e.split(".").length)),p.regcache.set(t,n)}}};let h,d="";function g(e,t){let n=e[t];if(null==n)throw{message:"Callback is not defined",name:t};return n}function m(e){return e.args?e.args.slice():void 0}function b(e){return 1===e.length&&null!=e[0].run}function y(e){let t=i;for(let n of e.split(".").slice(1))null!=t&&(t=t[n]);if("object"!=typeof t)throw{message:"Target is not accessible",property:e};return t}function v(e,t){if(e.run)return e.run;if(e.src){if("?"===e.src.path)return t;let n=t[e.src.path];if(e.as){let r=g(a,e.as.name),l=m(e.as);r.convert&&(n=r.convert.call(t,n,l))}return n}}function x(e,r,l){let i=t.parse(r.nodeValue);function s(t,n){n.nodeValue=v(t,e)??""}b(i)?l.appendChild(r.cloneNode()):i.forEach((t=>{let r=document.createTextNode("");if(t.src){if(h&&!t.as){let e=h[t.src.path];null!=e&&(t.as={name:e})}if(t.src.bind){let l=t.src.path,i=s.bind(void 0,t,r);n.listen(e,l,i),p.add(d,(o=>{n.remove(e,l,i),e=o,n.listen(e,l,i),s(t,r)}))}}s(t,r),l.appendChild(r)}))}function A(e,r,l){let i=r.name,s=r.value,o=t.parse(s);if(!o.length||b(o))return;let f=i.startsWith(":");function u(){let t=1===o.length?v(o[0],e):o.reduce(((t,n)=>t+=v(n,e)),"");f?l[i]=t:l.setAttribute(i,t)}f&&(l.removeAttribute(i),i=i.substring(1).replace(/-./g,(e=>e[1].toUpperCase()))),o.filter((e=>e.src)).forEach((t=>{if(h&&!t.as){let e=h[t.src.path];null!=e&&(t.as={name:e})}if(t.src.bind){let r=t.src.path;if(t.at){let n,s,o,u;t.as&&(n=g(a,t.as.name).revert,s=m(t.as)),t.at.callback&&(o=g(c,t.at.callback),u=m(t.at)),l.addEventListener(t.at.event,(()=>{let t=f?l[i]:l.getAttribute(i);n&&(t=n.call(e,t,s)),e[r]=t,o&&o.call(e,t,u)}))}let s=u;n.listen(e,r,s),p.add(d,(t=>{n.remove(e,r,s),e=t,n.listen(e,r,s),u()}))}})),u()}function E(e,t,n){for(let r of t.content.childNodes)r instanceof Element?k(e,r,n):r instanceof Text&&x(e,r,n)}function k(e,n,i){if(l.bypassTags.includes(n.tagName)){let e=n.cloneNode(!0);return i.appendChild(e),e}let a,c=h,b=d,v=n.cloneNode(!1),w=!1,O=v.getAttribute(":");if(O){let l=t.parse(O);if(!l||1!==l.length||l[0].run)throw{message:"Malformed bind expression",expression:O};v.removeAttribute(":");let i=l[0];if(i.src){let t=i.src.path;"."===t[0]?d=t:(d+="."+t,i.src.path=d),e=y(i.src.path)}if(i.if){let t=Boolean(i.if.func?g(s,i.if.path).call(e,m(i.if)):e[i.if.path]);if(i.if.not&&(t=!t),!t)return}if(i.is&&(h=g(o,i.is.name)),i.tpl){let t=document.querySelector(i.tpl.path);if(!(t instanceof HTMLTemplateElement))throw{message:"Template does not exist",expression:i.tpl.path};E(e,t,v)}if(Array.isArray(e))if(w=!0,i.src&&i.src.bind)!function j(e,t,n){let l=[];function i(e){let r;e.index<l.length&&(r=l[e.index][0]);let i=e.items.length;for(let s=0;s<i;s++){let i=e.items[s],o=[];for(let e=0;e<t.children.length;e++){let l=k(i,t.children[e],n);l&&(r&&n.insertBefore(l,r),o.push(l))}l.splice(e.index+s,0,o)}}function s(e){let t=e.items.length;for(let n=0;n<t;n++){let t=l[e.index+n];for(let e=0;e<t.length;e++)t[e].remove()}l.splice(e.index,t)}function o(e){let t=e.length,r=new Array(t);for(let n=0;n<t;n++)r[n]=l[e[n].before];for(let n=0;n<t;n++)l[e[n].after]=r[n];for(let i=t-1;i>=0;i--){let t=l[e[i].after+1],s=t?t[0]:null,o=r[i];for(let e=0;e<o.length;e++)n.insertBefore(o[e],s)}}function a(){for(let r of e){let e=[];for(let l=0;l<t.children.length;l++){let i=k(r,t.children[l],n);i&&e.push(i)}l.push(e)}r.observe(e),r.listen(e,"insert",i),r.listen(e,"remove",s),r.listen(e,"change",o)}p.add(d,(t=>{r.remove(e,"insert",i),r.remove(e,"remove",s),r.remove(e,"change",o);for(let e of l)for(let t of e)t.remove();l=[],e=t,a()})),a()}(e,n,v);else for(let t of e)for(let e of n.children)k(t,e,v);if(i.on)for(let t of i.on){let n=t.callback,r=e[n];r instanceof Function||(r=g(u,n)),v.addEventListener(t.event,(n=>{r.call(e,v,n,m(t))}))}if(i.do){let t=i.do.callback,n=e[t];n instanceof Function||(n=g(f,t)),a=n.bind(e,v,m(i.do))}i.src&&i.src.bind&&(p.add(d,(t=>{e=t})),p.listen(i.src.path))}for(let t of Array.from(v.attributes))A(e,t,v);if(!w)for(let t of n.childNodes)t instanceof Element?k(e,t,v):t instanceof Text&&x(e,t,v);return i.appendChild(v),a&&a(),h=c,d=b,v}function w(e,t,r,l){l||(l=r,r=e);let i=n.notify.bind(void 0,e,t);l.forEach((e=>n.listen(r,e,i)))}if(this.version="1.3",this.data=i,this.if=s,this.is=o,this.as=a,this.at=c,this.do=f,this.on=u,this.render=function O(e){let{source:t,target:n}=e||{};t||(t=document.querySelector("template")),n||(n=document.body);let r=document.body.style.display;document.body.style.display="none",t.remove(),E(i,t,n),document.body.style.display=r,p.cache()},this.depend=w,this.define=function j(e,t,n,r,l){n.configurable=!0,Object.defineProperty(e,t,n),r&&w(e,t,r,l)},this.notify=function T(e,t){n.notify(e,t)},e){"config"in e&&Object.assign(l,e.config);for(let t of["data","if","is","as","at","do","on"])t in e&&Object.assign(this[t],e[t])}Object.freeze(this)}export{e as Funa};